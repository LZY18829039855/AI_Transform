# 看板下钻功能使用说明

## 一、功能概述

看板下钻功能允许用户点击看板上的数字，查看该数字对应的具体员工信息列表。支持多种下钻类型和筛选条件。

## 二、接口说明

### 2.1 接口地址

```
POST /expert-cert-statistics/drill-down
```

### 2.2 请求参数

请求体为JSON格式，包含以下字段：

| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| drillDownType | String | 是 | 下钻类型：<br/>- EXPERT_CERT：专家认证统计下钻<br/>- EMPLOYEE_CERT：员工认证统计下钻<br/>- COMPETENCE_CATEGORY：职位类统计下钻<br/>- MATURITY：成熟度统计下钻 |
| deptCode | String | 是 | 部门编码 |
| personType | Integer | 否 | 人员类型（0-全员，用于员工认证统计、职位类统计、成熟度统计） |
| filterType | String | 是 | 筛选条件类型：<br/>- CERTIFIED：已认证人员<br/>- QUALIFIED：已任职人员<br/>- ALL：全部人员（基线人数）<br/>- CERTIFIED_ONLY：仅已认证（用于专家认证统计） |
| aiMaturity | String | 否 | AI成熟度（L1/L2/L3，用于专家认证统计和成熟度统计下钻） |
| jobCategory | String | 否 | 职位类（用于专家认证统计和职位类统计下钻） |
| pageNum | Integer | 否 | 页码（从1开始，默认1） |
| pageSize | Integer | 否 | 每页大小（默认20） |

### 2.3 响应格式

```json
{
    "code": 200,
    "message": "查询成功",
    "data": {
        "employeeList": [
            {
                "employeeNumber": "l00000001",
                "employeeName": "张三",
                "deptCode": "D001",
                "deptName": "研发部",
                "jobCategory": "软件类",
                "aiMaturity": "L2",
                "isCertified": true,
                "isQualified": true,
                "email": "zhangsan@huawei.com",
                "telephone": "0755-12345678",
                "mobile": "13800138000"
            }
        ],
        "total": 100,
        "pageNum": 1,
        "pageSize": 20,
        "totalPages": 5
    }
}
```

## 三、使用场景示例

### 3.1 专家认证统计下钻

**场景**：点击专家认证统计中某个成熟度下某个职位类的"认证人数"

**请求示例**：
```json
{
    "drillDownType": "EXPERT_CERT",
    "deptCode": "D008",
    "filterType": "CERTIFIED_ONLY",
    "aiMaturity": "L2",
    "jobCategory": "软件类",
    "pageNum": 1,
    "pageSize": 20
}
```

### 3.2 员工认证统计下钻

**场景**：点击员工认证统计中某个部门的"已认证人数"

**请求示例**：
```json
{
    "drillDownType": "EMPLOYEE_CERT",
    "deptCode": "D008",
    "personType": 0,
    "filterType": "CERTIFIED",
    "pageNum": 1,
    "pageSize": 20
}
```

**场景**：点击员工认证统计中某个部门的"已任职人数"

**请求示例**：
```json
{
    "drillDownType": "EMPLOYEE_CERT",
    "deptCode": "D008",
    "personType": 0,
    "filterType": "QUALIFIED",
    "pageNum": 1,
    "pageSize": 20
}
```

**场景**：点击员工认证统计中某个部门的"总人数"

**请求示例**：
```json
{
    "drillDownType": "EMPLOYEE_CERT",
    "deptCode": "D008",
    "personType": 0,
    "filterType": "ALL",
    "pageNum": 1,
    "pageSize": 20
}
```

### 3.3 职位类统计下钻

**场景**：点击职位类统计中某个职位类的"已认证人数"

**请求示例**：
```json
{
    "drillDownType": "COMPETENCE_CATEGORY",
    "deptCode": "D008",
    "personType": 0,
    "jobCategory": "软件类",
    "filterType": "CERTIFIED",
    "pageNum": 1,
    "pageSize": 20
}
```

### 3.4 成熟度统计下钻

**场景**：点击成熟度统计中某个成熟度的"已认证人数"

**请求示例**：
```json
{
    "drillDownType": "MATURITY",
    "deptCode": "D008",
    "personType": 0,
    "aiMaturity": "L2",
    "filterType": "CERTIFIED",
    "pageNum": 1,
    "pageSize": 20
}
```

## 四、前端集成建议

### 4.1 点击事件处理

在前端看板页面，为每个可点击的数字添加点击事件，根据点击的数字类型构造相应的请求参数：

```javascript
// 示例：点击专家认证统计中的认证人数
function handleExpertCertClick(deptCode, aiMaturity, jobCategory) {
    const request = {
        drillDownType: 'EXPERT_CERT',
        deptCode: deptCode,
        filterType: 'CERTIFIED_ONLY',
        aiMaturity: aiMaturity,
        jobCategory: jobCategory,
        pageNum: 1,
        pageSize: 20
    };
    
    // 调用下钻接口
    fetch('/expert-cert-statistics/drill-down', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(request)
    })
    .then(response => response.json())
    .then(data => {
        // 显示员工列表弹窗或跳转到员工列表页面
        showEmployeeList(data.data);
    });
}
```

### 4.2 参数映射关系

| 看板统计项 | drillDownType | filterType | 其他参数 |
|-----------|---------------|------------|----------|
| 专家认证人数 | EXPERT_CERT | CERTIFIED_ONLY | aiMaturity, jobCategory |
| 员工认证人数 | EMPLOYEE_CERT | CERTIFIED | personType |
| 员工任职人数 | EMPLOYEE_CERT | QUALIFIED | personType |
| 员工总人数 | EMPLOYEE_CERT | ALL | personType |
| 职位类认证人数 | COMPETENCE_CATEGORY | CERTIFIED | personType, jobCategory |
| 职位类任职人数 | COMPETENCE_CATEGORY | QUALIFIED | personType, jobCategory |
| 成熟度认证人数 | MATURITY | CERTIFIED | personType, aiMaturity |
| 成熟度任职人数 | MATURITY | QUALIFIED | personType, aiMaturity |

## 五、注意事项

1. **分页处理**：接口支持分页，前端需要处理分页逻辑，当用户翻页时传递相应的 `pageNum` 参数。

2. **参数校验**：
   - `drillDownType`、`deptCode`、`filterType` 为必填字段
   - 不同下钻类型需要不同的附加参数（如 `aiMaturity`、`jobCategory`）

3. **性能优化**：
   - 建议设置合理的 `pageSize`（建议20-50）
   - 对于大量数据的场景，可以考虑添加缓存

4. **错误处理**：
   - 接口会返回相应的错误信息，前端需要妥善处理
   - 常见错误：部门不存在、参数不合法等

## 六、扩展说明

如果需要支持更多的下钻维度或筛选条件，可以在 `DrillDownRequestVO` 中添加新的字段，并在 `ExpertCertStatisticsService.drillDown()` 方法中实现相应的逻辑。

