# 专家认证统计接口测试说明

## 接口信息

- **接口路径**: `/ai_transform/expert-cert-statistics/statistics`
- **请求方法**: `GET`
- **完整URL**: `http://localhost:8080/ai_transform/expert-cert-statistics/statistics?deptCode=D008`
- **请求参数**: 
  - `deptCode` (必填): 部门编码，例如：D008

## 测试步骤

### 1. 确保应用已启动

检查应用是否在运行：
```powershell
netstat -ano | findstr :8080
```

如果应用未启动，执行：
```powershell
mvn spring-boot:run
```

### 2. 测试接口

#### 方式一：使用PowerShell
```powershell
Invoke-RestMethod -Uri "http://localhost:8080/ai_transform/expert-cert-statistics/statistics?deptCode=D008" -Method GET -Headers @{"Accept"="application/json"} | ConvertTo-Json -Depth 10
```

#### 方式二：使用curl（如果已安装）
```bash
curl -X GET "http://localhost:8080/ai_transform/expert-cert-statistics/statistics?deptCode=D008" -H "Accept: application/json"
```

#### 方式三：使用浏览器
直接在浏览器访问：
```
http://localhost:8080/ai_transform/expert-cert-statistics/statistics?deptCode=D008
```

#### 方式四：使用Postman
- URL: `http://localhost:8080/ai_transform/expert-cert-statistics/statistics`
- Method: GET
- Params: `deptCode=D008`

## 预期响应格式

```json
{
  "code": 200,
  "message": "查询成功",
  "data": {
    "deptCode": "D008",
    "deptName": "自动化测试组",
    "deptLevel": "2",
    "maturityStatistics": [
      {
        "aiMaturity": "L2",
        "baselineCount": 10,
        "certCount": 5,
        "certRate": 50.0000
      }
    ],
    "maturityJobCategoryStatistics": [
      {
        "aiMaturity": "L2",
        "jobCategory": "测试类",
        "baselineCount": 3,
        "certCount": 2,
        "certRate": 66.6667
      }
    ]
  }
}
```

## 错误处理

### 404错误
可能原因：
1. 应用未启动
2. Controller未正确加载
3. 接口路径错误

解决方法：
1. 检查应用是否启动：`netstat -ano | findstr :8080`
2. 查看应用启动日志，确认Controller是否加载
3. 确认context-path配置：`/ai_transform`
4. 重新编译项目：`mvn clean package`

### 400错误
可能原因：
1. 部门编码不存在
2. 部门层级不是3层或4层
3. 参数格式错误

### 500错误
可能原因：
1. 数据库连接失败
2. SQL查询错误
3. 业务逻辑异常

查看详细错误信息在响应中的message字段。

## 接口功能说明

1. **查询部门信息**: 根据部门编码查询部门的层级和名称
2. **查询专家数据**: 
   - 三层部门：查询`org_level=3`且组织匹配的专家
   - 四层部门：查询`l4_org_code`匹配的专家
3. **统计AI成熟度**: 按L1/L2/L3分组统计
4. **统计职位类**: 按AI成熟度+职位类分组统计
5. **查询认证状态**: 通过工号关联`dwr_t_cert_record_t`表查询AI认证状态
6. **计算占比**: 自动计算认证人数占比




