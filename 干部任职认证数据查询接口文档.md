# 干部任职认证数据查询接口文档

## 1. 接口概述

### 1.1 接口名称
干部任职认证数据查询接口

### 1.2 接口描述
查询指定部门下各AI成熟度下各职位类的任职认证数据，包括基数人数、通过认证人数、认证人数占比、科目二通过人数和科目二通过率等统计信息。

### 1.3 接口路径
```
GET /cadre-cert-statistics/by-maturity-and-job-category
```

### 1.4 请求方式
GET

---

## 2. 请求参数

### 2.1 请求头
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| Content-Type | String | 是 | application/json |

### 2.2 查询参数（Query Parameters）

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| deptCode | String | 是 | 部门ID（部门编码） | "DEPT_3_001" |

### 2.3 请求示例
```
GET /cadre-cert-statistics/by-maturity-and-job-category?deptCode=DEPT_3_001
```

---

## 3. 响应参数

### 3.1 响应结构

```json
{
  "code": 200,
  "message": "查询成功",
  "data": {
    "deptCode": "DEPT_3_001",
    "deptName": "装备部",
    "maturityStatistics": [
      {
        "maturityLevel": "L1",
        "baselineCount": 100,
        "certifiedCount": 80,
        "certRate": 80.0000,
        "subject2PassCount": 60,
        "subject2PassRate": 75.0000,
        "jobCategoryStatistics": [
          {
            "jobCategory": "软件类",
            "baselineCount": 50,
            "certifiedCount": 40,
            "certRate": 80.0000,
            "subject2PassCount": 30,
            "subject2PassRate": 75.0000
          },
          {
            "jobCategory": "系统类",
            "baselineCount": 30,
            "certifiedCount": 25,
            "certRate": 83.3333,
            "subject2PassCount": 20,
            "subject2PassRate": 80.0000
          },
          {
            "jobCategory": "研究类",
            "baselineCount": 20,
            "certifiedCount": 15,
            "certRate": 75.0000,
            "subject2PassCount": 10,
            "subject2PassRate": 66.6667
          }
        ]
      },
      {
        "maturityLevel": "L2",
        "baselineCount": 80,
        "certifiedCount": 70,
        "certRate": 87.5000,
        "subject2PassCount": 55,
        "subject2PassRate": 78.5714,
        "jobCategoryStatistics": [
          {
            "jobCategory": "软件类",
            "baselineCount": 40,
            "certifiedCount": 35,
            "certRate": 87.5000,
            "subject2PassCount": 28,
            "subject2PassRate": 80.0000
          },
          {
            "jobCategory": "系统类",
            "baselineCount": 25,
            "certifiedCount": 22,
            "certRate": 88.0000,
            "subject2PassCount": 17,
            "subject2PassRate": 77.2727
          },
          {
            "jobCategory": "研究类",
            "baselineCount": 15,
            "certifiedCount": 13,
            "certRate": 86.6667,
            "subject2PassCount": 10,
            "subject2PassRate": 76.9231
          }
        ]
      },
      {
        "maturityLevel": "L3",
        "baselineCount": 60,
        "certifiedCount": 55,
        "certRate": 91.6667,
        "subject2PassCount": 45,
        "subject2PassRate": 81.8182,
        "jobCategoryStatistics": [
          {
            "jobCategory": "软件类",
            "baselineCount": 30,
            "certifiedCount": 28,
            "certRate": 93.3333,
            "subject2PassCount": 23,
            "subject2PassRate": 82.1429
          },
          {
            "jobCategory": "系统类",
            "baselineCount": 20,
            "certifiedCount": 18,
            "certRate": 90.0000,
            "subject2PassCount": 15,
            "subject2PassRate": 83.3333
          },
          {
            "jobCategory": "研究类",
            "baselineCount": 10,
            "certifiedCount": 9,
            "certRate": 90.0000,
            "subject2PassCount": 7,
            "subject2PassRate": 77.7778
          }
        ]
      }
    ],
    "totalStatistics": {
      "maturityLevel": "总计",
      "baselineCount": 240,
      "certifiedCount": 205,
      "certRate": 85.4167,
      "subject2PassCount": 160,
      "subject2PassRate": 78.0488
    }
  }
}
```

### 3.2 响应字段说明

#### 3.2.1 响应根对象（CadreMaturityJobCategoryCertStatisticsResponseVO）

| 字段名 | 类型 | 说明 |
|--------|------|------|
| deptCode | String | 部门ID（部门编码） |
| deptName | String | 部门名称 |
| maturityStatistics | List<CadreMaturityCertStatisticsVO> | 各成熟度统计列表 |
| totalStatistics | CadreMaturityCertStatisticsVO | 总计统计（不包含职位类明细） |

#### 3.2.2 成熟度统计对象（CadreMaturityCertStatisticsVO）

| 字段名 | 类型 | 说明 |
|--------|------|------|
| maturityLevel | String | AI成熟度等级（L1/L2/L3） |
| baselineCount | Integer | 基数人数（该成熟度下的干部总人数） |
| certifiedCount | Integer | 通过认证人数（该成熟度下已通过华为研究类能力认证的干部人数） |
| certRate | BigDecimal | 认证人数占比（百分比，保留4位小数）计算公式：certifiedCount / baselineCount * 100 |
| subject2PassCount | Integer | 科目二通过人数（该成熟度下已通过科目二考试的干部人数） |
| subject2PassRate | BigDecimal | 科目二通过率（百分比，保留4位小数）计算公式：subject2PassCount / baselineCount * 100（如果baselineCount为0，则为0） |
| jobCategoryStatistics | List<CadreJobCategoryCertStatisticsVO> | 该成熟度下各职位类的统计列表（可选，如果该成熟度下没有职位类数据，则为空数组） |

#### 3.2.3 职位类统计对象（CadreJobCategoryCertStatisticsVO）

| 字段名 | 类型 | 说明 |
|--------|------|------|
| jobCategory | String | 职位类名称（如：软件类、系统类、研究类等） |
| baselineCount | Integer | 基数人数（该职位类下的干部总人数） |
| certifiedCount | Integer | 通过认证人数（该职位类下已通过华为研究类能力认证的干部人数） |
| certRate | BigDecimal | 认证人数占比（百分比，保留4位小数）计算公式：certifiedCount / baselineCount * 100 |
| subject2PassCount | Integer | 科目二通过人数（该职位类下已通过科目二考试的干部人数） |
| subject2PassRate | BigDecimal | 科目二通过率（百分比，保留4位小数）计算公式：subject2PassCount / baselineCount * 100（如果baselineCount为0，则为0） |

#### 3.2.4 总计统计对象（CadreMaturityCertStatisticsVO）

| 字段名 | 类型 | 说明 |
|--------|------|------|
| maturityLevel | String | 固定为"总计" |
| baselineCount | Integer | 所有成熟度的基数人数总和 |
| certifiedCount | Integer | 所有成熟度的通过认证人数总和 |
| certRate | BigDecimal | 总体认证人数占比（百分比，保留4位小数）计算公式：certifiedCount / baselineCount * 100 |
| subject2PassCount | Integer | 所有成熟度的科目二通过人数总和 |
| subject2PassRate | BigDecimal | 总体科目二通过率（百分比，保留4位小数）计算公式：subject2PassCount / baselineCount * 100（如果baselineCount为0，则为0） |
| jobCategoryStatistics | List | 总计统计不包含职位类明细，此字段为null或空数组 |

---

## 4. 业务规则

### 4.1 数据范围
- 仅统计干部数据（personType=1）
- 统计指定部门下的所有干部（包括子部门）
- 按AI成熟度（L1/L2/L3）和职位类进行分组统计

### 4.2 认证判断标准
- 通过认证：干部已通过"华为研究类能力认证（专业级，xxx）"且状态为已通过（status=1或approved_status=1）
- 认证人数占比 = 通过认证人数 / 基数人数 * 100

### 4.3 科目二判断标准
- 科目二通过：干部在t_exam_record表中存在通过记录（is_pass=1且exam_name不为空）
- 科目二通过率 = 科目二通过人数 / 当前分类下的总人数（baselineCount）* 100
- 注意：科目二通过人数不能超过当前分类下的总人数（baselineCount）

### 4.4 数据精度
- 所有百分比字段（certRate、subject2PassRate）保留4位小数
- 使用四舍五入模式（RoundingMode.HALF_UP）

### 4.5 空值处理
- 如果某个成熟度下没有数据，baselineCount、certifiedCount、subject2PassCount均为0，对应的比率字段为0.0000
- 如果基数人数（baselineCount）为0，科目二通过率固定为0.0000（避免除零错误）

---

## 5. 错误响应

### 5.1 错误响应格式

```json
{
  "code": 400,
  "message": "部门ID不能为空",
  "data": null
}
```

### 5.2 错误码说明

| 错误码 | 说明 |
|--------|------|
| 400 | 请求参数错误（如：部门ID为空、部门不存在等） |
| 500 | 系统异常 |

### 5.3 错误响应示例

#### 5.3.1 部门ID为空
```json
{
  "code": 400,
  "message": "部门ID不能为空",
  "data": null
}
```

#### 5.3.2 部门不存在
```json
{
  "code": 400,
  "message": "部门不存在：DEPT_999",
  "data": null
}
```

#### 5.3.3 系统异常
```json
{
  "code": 500,
  "message": "系统异常：数据库连接失败",
  "data": null
}
```

---

## 6. 接口实现说明

### 6.1 Controller层
- 路径：`/cadre-cert-statistics/by-maturity-and-job-category`
- 方法：`GET`
- 参数校验：检查deptCode是否为空
- 异常处理：统一使用GlobalExceptionHandler处理

### 6.2 Service层
- 方法名：`getCadreMaturityJobCategoryCertStatistics(String deptCode)`
- 主要逻辑：
  1. 根据部门ID查询部门信息，验证部门是否存在
  2. 查询该部门下的所有干部数据（包括子部门）
  3. 按AI成熟度和职位类进行分组统计
  4. 计算认证人数和科目二通过人数
  5. 计算各项比率
  6. 构建响应对象

### 6.3 数据查询
- 干部数据来源：`t_cadre`表
- 认证数据来源：`dwr_t_cert_record_t`表
- 科目二数据来源：`t_exam_record`表或`dwr_t_exam_record_t`表
- AI成熟度数据来源：`department_ai_maturity`表或干部表中的`position_maturity`字段
- 职位类数据来源：干部表中的`cadre_position_type`字段或相关职位类字段

---

## 7. 注意事项

1. **部门层级支持**：接口应支持查询三层和四层部门，根据部门层级自动选择查询方式
2. **数据一致性**：确保统计的基数人数、认证人数、科目二通过人数之间的逻辑关系正确
3. **性能优化**：对于大数据量部门，考虑使用分页或缓存机制
4. **数据准确性**：科目二通过人数必须小于等于当前分类下的总人数（baselineCount）
5. **空数据处理**：对于没有数据的成熟度或职位类，返回0值而不是null

---

## 8. 版本信息

- 接口版本：v1.0
- 创建日期：2024-12-19
- 最后更新：2024-12-19

