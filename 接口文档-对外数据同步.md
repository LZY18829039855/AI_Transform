# 对外开放数据同步更新接口文档

## 1. 接口概述
本接口用于同步 `t_employee_sync` 表中的最新数据到 `t_employee` 表。
接口执行全量比对逻辑：查询 `t_employee` 现有数据与 `t_employee_sync` (按 `period_id` 过滤) 的最新数据进行对比，执行新增、更新或删除操作。

## 2. 接口定义

### 2.1 接口地址
- **URL**: `/external-api/sync-employee-data`
- **Method**: `POST`
- **Content-Type**: `application/json`

### 2.2 请求参数

| 参数名 | 类型 | 必填 | 说明 | 示例 |
| :--- | :--- | :--- | :--- | :--- |
| (无) | - | - | 接口自动推算数据期号 | - |

### 2.3 业务规则
1. **Period ID 推算**: 系统自动取当前服务器日期减 2 天作为 `period_id` (格式 `yyyyMMdd`)，用于从 `t_employee_sync` 获取最新源数据。
2. **同步逻辑**:
   - **源数据**: `t_employee_sync` (过滤 `period_id`) + 任职/认证达标状态计算。
   - **目标数据**: `t_employee` 全量数据。
   - **比对规则** (以 `employee_number` 为主键):
     - **新增**: 源数据有，目标数据无 -> **插入**。
     - **更新**: 源数据有，目标数据有，且非忽略字段 (`period_id`, `updated_time`) 的内容不一致 -> **更新**。
     - **删除**: 源数据无，目标数据有 -> **删除**。
   - **判定一致性忽略字段**: `period_id` 不参与一致性比对。

### 2.4 响应结果

返回同步执行的统计结果。

```json
{
  "code": 200,
  "msg": "success",
  "data": {
    "periodId": "20251228",
    "totalSource": 1000,
    "insertCount": 10,
    "updateCount": 5,
    "deleteCount": 2,
    "ignoreCount": 983
  }
}
```

## 3. 字段映射与逻辑

### 3.1 字段映射

| 目标表 (`t_employee`) | 源表/逻辑 (`t_employee_sync`) | 说明 |
| :--- | :--- | :--- |
| employee_number | employee_number | 主键 |
| last_name | last_name | 姓名 |
| firstdeptcode | firstdeptcode | 一级部门编码 |
| seconddeptcode | seconddeptcode | 二级部门编码 |
| thirddeptcode | thirddeptcode | 三级部门编码 |
| fourthdeptcode | fourthdeptcode | 四级部门编码 |
| fifthdeptcode | fifthdeptcode | 五级部门编码 |
| sixthdeptcode | sixthdeptcode | 六级部门编码 |
| lowestdeptid | lowest_dept_number | 最小部门ID |
| firstdept | firstdept (解析) | 一级部门名称 |
| seconddept | seconddept (解析) | 二级部门名称 |
| thirddept | thirddept (解析) | 三级部门名称 |
| fourthdept | fourthdept (解析) | 四级部门名称 |
| fifthdept | fifthdept (解析) | 五级部门名称 |
| sixthdept | sixthdept (解析) | 六级部门名称 |
| lowestdept | lowest_dept | 最小部门名称 |
| job_type | job_category (解析) | 职位族 |
| job_category | job_category (解析) | 职位类 |
| job_subcategory | job_category (解析) | 职位子类 |
| period_id | period_id | 数据期号 (不参与一致性对比) |
| updated_time | (系统当前时间) | 更新时间 |
| is_qualifications_standard | (计算逻辑) | 任职是否达标 |
| is_cert_standard | (计算逻辑) | 认证是否达标 |

### 3.2 达标判定逻辑
(同原文档，此处省略详细描述，保持与 `employee-cert-statistics` 一致)
