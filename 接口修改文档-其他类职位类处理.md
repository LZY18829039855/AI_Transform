# 接口修改文档：其他类职位类处理逻辑优化

## 修改概述

修改 `/cadre-qualified-details` 和 `/person-cert-details` 两个接口，当入参中人员类型为全员（personType=0），职位类传的是"其他类"时，后端应该查询除了软件类、研究类、测试类、系统类以及**产品开发项目管理类**之外的其他所有职位类的数据。

## 问题描述

当前实现中，当 `personType=0`（全员）且 `jobCategory='其他类'` 时，SQL查询条件只排除了：
- 研究类
- 软件类
- 系统类
- 测试类

但根据业务需求，还应该排除：
- **产品开发项目管理类**

## 涉及接口

1. **GET** `/expert-cert-statistics/cadre-qualified-details` - 查询干部或专家任职数据
2. **GET** `/expert-cert-statistics/person-cert-details` - 查询干部或专家认证数据

## 修改范围

### 修改文件

- `src/main/resources/mapper/EmployeeMapper.xml`

### 修改位置

#### 1. `getEmployeeCertDetailsByDeptLevel` 方法（第233-240行）

**当前代码：**
```xml
<when test="jobCategory == '其他类'">
    AND (
        CASE 
            WHEN e.job_category LIKE '%-%-%' THEN SUBSTRING_INDEX(SUBSTRING_INDEX(e.job_category, '-', 2), '-', -1)
            WHEN e.job_category LIKE '%-%' THEN SUBSTRING_INDEX(e.job_category, '-', -1)
            ELSE e.job_category
        END
    ) NOT IN ('研究类', '软件类', '系统类', '测试类')
</when>
```

**修改后：**
```xml
<when test="jobCategory == '其他类'">
    AND (
        CASE 
            WHEN e.job_category LIKE '%-%-%' THEN SUBSTRING_INDEX(SUBSTRING_INDEX(e.job_category, '-', 2), '-', -1)
            WHEN e.job_category LIKE '%-%' THEN SUBSTRING_INDEX(e.job_category, '-', -1)
            ELSE e.job_category
        END
    ) NOT IN ('研究类', '软件类', '系统类', '测试类', '产品开发项目管理类')
</when>
```

#### 2. `getEmployeeQualifiedDetailsByDeptLevel` 方法（第502-509行）

**当前代码：**
```xml
<when test="jobCategory == '其他类'">
    AND (
        CASE 
            WHEN e.job_category LIKE '%-%-%' THEN SUBSTRING_INDEX(SUBSTRING_INDEX(e.job_category, '-', 2), '-', -1)
            WHEN e.job_category LIKE '%-%' THEN SUBSTRING_INDEX(e.job_category, '-', -1)
            ELSE e.job_category
        END
    ) NOT IN ('研究类', '软件类', '系统类', '测试类')
</when>
```

**修改后：**
```xml
<when test="jobCategory == '其他类'">
    AND (
        CASE 
            WHEN e.job_category LIKE '%-%-%' THEN SUBSTRING_INDEX(SUBSTRING_INDEX(e.job_category, '-', 2), '-', -1)
            WHEN e.job_category LIKE '%-%' THEN SUBSTRING_INDEX(e.job_category, '-', -1)
            ELSE e.job_category
        END
    ) NOT IN ('研究类', '软件类', '系统类', '测试类', '产品开发项目管理类')
</when>
```

## 修改说明

### 影响范围

- **仅影响**：当 `personType=0`（全员）且 `jobCategory='其他类'` 时的查询结果
- **不影响**：其他人员类型（干部、专家）或其他职位类的查询逻辑
- **不影响**：其他接口的查询逻辑

### 业务逻辑

修改后，当查询条件为：
- `personType=0`（全员）
- `jobCategory='其他类'`

查询结果将排除以下职位类：
1. 软件类
2. 研究类
3. 测试类
4. 系统类
5. **产品开发项目管理类**（新增）

查询将返回除上述5类之外的所有其他职位类的数据。

## 测试建议

### 测试场景

1. **场景1：全员 + 其他类 - 认证数据**
   - 接口：`GET /expert-cert-statistics/person-cert-details`
   - 参数：`personType=0&jobCategory=其他类&queryType=1`
   - 验证：返回的数据中不应包含软件类、研究类、测试类、系统类、产品开发项目管理类

2. **场景2：全员 + 其他类 - 任职数据**
   - 接口：`GET /expert-cert-statistics/cadre-qualified-details`
   - 参数：`personType=0&jobCategory=其他类&queryType=1`
   - 验证：返回的数据中不应包含软件类、研究类、测试类、系统类、产品开发项目管理类

3. **场景3：验证其他职位类不受影响**
   - 接口：`GET /expert-cert-statistics/person-cert-details`
   - 参数：`personType=0&jobCategory=软件类&queryType=1`
   - 验证：仍然只返回软件类数据（不受影响）

4. **场景4：验证其他人员类型不受影响**
   - 接口：`GET /expert-cert-statistics/person-cert-details`
   - 参数：`personType=1&jobCategory=其他类&queryType=1`
   - 验证：干部类型的其他类查询逻辑不受影响（干部类型走的是不同的Mapper方法）

## 注意事项

1. 确保数据库中职位类字段的值与代码中的字符串完全匹配（包括大小写）
2. 修改后需要重新编译和部署应用
3. 建议在测试环境先验证修改效果，确认无误后再部署到生产环境
4. **本次修改仅针对全员类型（personType=0）**，专家类型（personType=2）和干部类型（personType=1）的"其他类"处理逻辑保持不变

## 其他说明

### 代码中其他"其他类"处理位置

代码中还有其他地方处理"其他类"的逻辑，但本次**不需要修改**：

1. **ExpertCertStatisticsService.java**（第1764-1770行、第1984-1990行）
   - 这些是处理专家类型（personType=2）的逻辑
   - 专家类型走的是不同的代码路径，不受本次修改影响

2. **ExpertCertStatisticsMapper.xml**（第233行、第531行）
   - 这些也是处理专家类型的Mapper查询
   - 不受本次修改影响

### 为什么只修改全员类型？

根据需求描述："当入参中人员类型为全员"，明确指定了只修改全员类型的逻辑。如果后续需要同步修改专家类型或干部类型的"其他类"处理逻辑，需要单独评估和修改。

## 修改文件清单

- [ ] `src/main/resources/mapper/EmployeeMapper.xml` - 修改两处 `jobCategory == '其他类'` 的判断逻辑（仅影响全员类型查询）

