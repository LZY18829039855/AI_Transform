# 干部任职数据查询接口文档

## 1. 接口概述

### 1.1 接口名称
干部任职数据查询接口（按成熟度和职位类统计）

### 1.2 接口描述
查询指定部门下各AI成熟度（L2/L3）下各职位类的任职数据，包括基数人数、通过任职人数、任职人数占比等统计信息。注意：本接口仅统计L2和L3成熟度的数据，不包含L1数据。

### 1.3 接口路径
```
GET /cadre-cert-statistics/by-maturity-and-job-category-qualified
```

### 1.4 请求方式
GET

---

## 2. 请求参数

### 2.1 请求头
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| Content-Type | String | 是 | application/json |

### 2.2 查询参数（Query Parameters）

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| deptId | String | 否 | 部门ID（部门编码），当为"0"或为空时，默认查询云核心网部门ID（030681） | "DEPT_3_001" 或 "0" |

### 2.3 请求示例

```
GET /cadre-cert-statistics/by-maturity-and-job-category-qualified?deptId=DEPT_3_001
```

```
GET /cadre-cert-statistics/by-maturity-and-job-category-qualified?deptId=0
```

```
GET /cadre-cert-statistics/by-maturity-and-job-category-qualified
```

---

## 3. 响应参数

### 3.1 响应结构

```json
{
  "code": 200,
  "message": "查询成功",
  "data": {
    "deptCode": "030681",
    "deptName": "云核心网",
    "maturityStatistics": [
      {
        "maturityLevel": "L2",
        "baselineCount": 80,
        "qualifiedCount": 56,
        "qualifiedRate": 70.0000,
        "jobCategoryStatistics": [
          {
            "jobCategory": "软件类",
            "baselineCount": 40,
            "qualifiedCount": 28,
            "qualifiedRate": 70.0000
          },
          {
            "jobCategory": "系统类",
            "baselineCount": 25,
            "qualifiedCount": 18,
            "qualifiedRate": 72.0000
          },
          {
            "jobCategory": "研究类",
            "baselineCount": 15,
            "qualifiedCount": 10,
            "qualifiedRate": 66.6667
          }
        ]
      },
      {
        "maturityLevel": "L3",
        "baselineCount": 60,
        "qualifiedCount": 48,
        "qualifiedRate": 80.0000,
        "jobCategoryStatistics": [
          {
            "jobCategory": "软件类",
            "baselineCount": 30,
            "qualifiedCount": 24,
            "qualifiedRate": 80.0000
          },
          {
            "jobCategory": "系统类",
            "baselineCount": 20,
            "qualifiedCount": 16,
            "qualifiedRate": 80.0000
          },
          {
            "jobCategory": "研究类",
            "baselineCount": 10,
            "qualifiedCount": 8,
            "qualifiedRate": 80.0000
          }
        ]
      }
    ],
    "totalStatistics": {
      "maturityLevel": "总计",
      "baselineCount": 140,
      "qualifiedCount": 104,
      "qualifiedRate": 74.2857
    }
  }
}
```

### 3.2 响应字段说明

#### 3.2.1 响应根对象（CadreMaturityJobCategoryQualifiedStatisticsResponseVO）

| 字段名 | 类型 | 说明 |
|--------|------|------|
| deptCode | String | 部门ID（部门编码） |
| deptName | String | 部门名称 |
| maturityStatistics | List<CadreMaturityQualifiedStatisticsVO> | 各成熟度统计列表 |
| totalStatistics | CadreMaturityQualifiedStatisticsVO | 总计统计（不包含职位类明细） |

#### 3.2.2 成熟度统计对象（CadreMaturityQualifiedStatisticsVO）

| 字段名 | 类型 | 说明 |
|--------|------|------|
| maturityLevel | String | AI成熟度等级（L2/L3，不包含L1） |
| baselineCount | Integer | 基数人数（该成熟度下的干部总人数） |
| qualifiedCount | Integer | 通过任职人数（该成熟度下已获得AI任职的干部人数） |
| qualifiedRate | BigDecimal | 任职人数占比（百分比，保留4位小数）计算公式：qualifiedCount / baselineCount * 100 |
| jobCategoryStatistics | List<CadreJobCategoryQualifiedStatisticsVO> | 该成熟度下各职位类的统计列表（可选，如果该成熟度下没有职位类数据，则为空数组） |

#### 3.2.3 职位类统计对象（CadreJobCategoryQualifiedStatisticsVO）

| 字段名 | 类型 | 说明 |
|--------|------|------|
| jobCategory | String | 职位类名称（如：软件类、系统类、研究类等） |
| baselineCount | Integer | 基数人数（该职位类下的干部总人数） |
| qualifiedCount | Integer | 通过任职人数（该职位类下已获得AI任职的干部人数） |
| qualifiedRate | BigDecimal | 任职人数占比（百分比，保留4位小数）计算公式：qualifiedCount / baselineCount * 100 |

#### 3.2.4 总计统计对象（CadreMaturityQualifiedStatisticsVO）

| 字段名 | 类型 | 说明 |
|--------|------|------|
| maturityLevel | String | 固定为"总计" |
| baselineCount | Integer | L2和L3成熟度的基数人数总和 |
| qualifiedCount | Integer | L2和L3成熟度的通过任职人数总和 |
| qualifiedRate | BigDecimal | 总体任职人数占比（百分比，保留4位小数）计算公式：qualifiedCount / baselineCount * 100（仅统计L2和L3） |
| jobCategoryStatistics | List | 总计统计不包含职位类明细，此字段为null或空数组 |

---

## 4. 业务规则

### 4.1 数据范围
- 仅统计干部数据（personType=1）
- 统计指定部门下的所有干部（包括子部门）
- 按AI成熟度（L2/L3）和职位类进行分组统计
- **注意：本接口仅统计L2和L3成熟度的数据，不包含L1数据**

### 4.2 任职判断标准
- 通过任职：干部在`t_qualifications`表中存在有效的AI任职记录，需满足以下条件：
  - `direction_cn_name`在以下AI方向列表中：
    - 数据科学与AI工程（ICT）
    - AI算法及应用（ICT）
    - AI软件工程与工具（ICT）
    - AI系统测试（ICT）
  - `competence_from`和`competence_to`不为空
  - 当前日期在`competence_from`和`competence_to`之间（包含边界）
- 任职人数占比 = 通过任职人数 / 基数人数 * 100

### 4.3 数据精度
- 所有百分比字段（qualifiedRate）保留4位小数
- 使用四舍五入模式（RoundingMode.HALF_UP）

### 4.4 空值处理
- 如果某个成熟度下没有数据，baselineCount、qualifiedCount均为0，对应的比率字段为0.0000
- 如果基数人数（baselineCount）为0，任职人数占比固定为0.0000（避免除零错误）

### 4.5 部门ID默认值处理
- 当`deptId`参数为"0"、空字符串或未提供时，默认查询云核心网部门ID（030681）下的所有部门数据

---

## 5. 错误响应

### 5.1 错误响应格式

```json
{
  "code": 400,
  "message": "部门不存在：DEPT_999",
  "data": null
}
```

### 5.2 错误码说明

| 错误码 | 说明 |
|--------|------|
| 400 | 请求参数错误（如：部门不存在等） |
| 500 | 系统异常 |

### 5.3 错误响应示例

#### 5.3.1 部门不存在
```json
{
  "code": 400,
  "message": "部门不存在：DEPT_999",
  "data": null
}
```

#### 5.3.2 系统异常
```json
{
  "code": 500,
  "message": "系统异常：数据库连接失败",
  "data": null
}
```

---

## 6. 接口实现说明

### 6.1 Controller层
- 路径：`/cadre-cert-statistics/by-maturity-and-job-category-qualified`
- 方法：`GET`
- 参数校验：检查deptId参数，当为"0"、空或未提供时，使用默认值"030681"
- 异常处理：统一使用GlobalExceptionHandler处理

### 6.2 Service层
- 方法名：`getCadreMaturityJobCategoryQualifiedStatistics(String deptId)`
- 主要逻辑：
  1. 根据部门ID查询部门信息，验证部门是否存在（当deptId为"0"或空时，使用默认值"030681"）
  2. 查询该部门下的所有干部数据（包括子部门）
  3. 按AI成熟度（L2/L3）和职位类进行分组统计（仅统计L2和L3，不包含L1）
  4. 查询已获得AI任职的干部工号列表（通过`getQualifiedEmployeeNumbers`方法）
  5. 计算各分组下的任职人数
  6. 计算各项比率
  7. 构建响应对象

### 6.3 数据查询
- 干部数据来源：`t_cadre`表
- 任职数据来源：`t_qualifications`表
- AI成熟度数据来源：`department_ai_maturity`表或干部表中的`position_maturity`字段
- 职位类数据来源：干部表中的`cadre_position_type`字段或相关职位类字段

---

## 7. 注意事项

1. **部门层级支持**：接口应支持查询三层和四层部门，根据部门层级自动选择查询方式
2. **数据一致性**：确保统计的基数人数、任职人数之间的逻辑关系正确
3. **性能优化**：对于大数据量部门，考虑使用分页或缓存机制
4. **数据准确性**：任职人数必须小于等于当前分类下的总人数（baselineCount）
5. **空数据处理**：对于没有数据的成熟度或职位类，返回0值而不是null
6. **默认部门处理**：当deptId为"0"、空字符串或未提供时，自动使用云核心网部门ID（030681）进行查询
7. **成熟度范围限制**：本接口仅统计L2和L3成熟度的数据，L1成熟度的数据将被过滤，不参与统计和计算

---

## 8. 版本信息

- 接口版本：v1.0
- 创建日期：2024-12-19
- 最后更新：2024-12-19

