<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.huawei.aitransform.mapper.DepartmentInfoMapper">

    <!-- 根据父部门编码查询所有子部门（只返回部门ID和中文名称） -->
    <select id="getChildDepartments" resultType="com.huawei.aitransform.entity.DepartmentInfoVO">
        SELECT 
            dept_code AS deptCode,
            dept_name AS deptName
        FROM department_info_hrms
        WHERE parent_dept_code = #{parentDeptCode}
        ORDER BY dept_code
    </select>

    <!-- 根据部门编码查询部门信息 -->
    <select id="getDepartmentByCode" resultType="com.huawei.aitransform.entity.DepartmentInfoVO">
        SELECT 
            dept_code AS deptCode,
            dept_name AS deptName,
            dept_level AS deptLevel,
            parent_dept_code AS parentDeptCode
        FROM department_info_hrms
        WHERE dept_code = #{deptCode}
        LIMIT 1
    </select>

    <!-- 查询所有四级部门 -->
    <select id="getAllLevel4Departments" resultType="com.huawei.aitransform.entity.DepartmentInfoVO">
        SELECT 
            dept_code AS deptCode,
            dept_name AS deptName,
            dept_level AS deptLevel,
            parent_dept_code AS parentDeptCode
        FROM department_info_hrms
        WHERE dept_level = '4'
        ORDER BY dept_code
    </select>

    <!-- 查询指定2级部门下的所有四级部门 -->
    <select id="getLevel4DepartmentsUnderLevel2" resultType="com.huawei.aitransform.entity.DepartmentInfoVO">
        SELECT DISTINCT
            d4.dept_code AS deptCode,
            d4.dept_name AS deptName,
            d4.dept_level AS deptLevel,
            d4.parent_dept_code AS parentDeptCode
        FROM department_info_hrms d4
        INNER JOIN department_info_hrms d3 ON d4.parent_dept_code = d3.dept_code AND d3.dept_level = '3'
        WHERE d4.dept_level = '4'
        AND d3.parent_dept_code = #{level2DeptCode}
        ORDER BY d4.dept_code
    </select>

</mapper>

